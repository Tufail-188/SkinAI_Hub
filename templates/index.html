<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinAI Hub â€“ AI Skin Detection</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { padding-top: 80px; }
        .hero { background: #f8f9fa; padding: 60px 0; text-align: center; }
        .uploaded-img { max-height: 250px; border-radius: 10px; object-fit: cover; }
        .info-box { background: #e8f0ff; padding: 15px; border-left: 5px solid #0d6efd; border-radius: 6px; }
        .care-box { background: #fff3cd; padding: 15px; border-left: 5px solid #ffc107; border-radius: 6px; }
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">SkinAI Hub</a>

        <div class="d-flex">
            <a href="/admin/appointments" class="btn btn-light me-2">View Appointments</a>
            <a href="/logout" class="btn btn-outline-light">Logout</a>
        </div>
    </div>
</nav>

<!-- Hero -->
<section class="hero">
    <div class="container">
        <h1 class="display-5 fw-bold">AI-Powered Skin Disease Detection</h1>
        <p class="lead">Upload a skin image and get instant prediction using AI.</p>
    </div>
</section>

<!-- Prediction Section -->
<div class="container py-5">
    <h3 class="text-center fw-semibold mb-4">Upload Skin Image</h3>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm">
        <label class="form-label fw-semibold">Choose Skin Image:</label>
        <input type="file" name="file" accept="image/*" class="form-control mb-3" required>
        <button class="btn btn-success w-100">Predict</button>
    </form>

    <!-- Show Uploaded Image -->
    {% if uploaded_image_path %}
    <div class="text-center mt-4">
        <h5 class="fw-bold">Uploaded Image</h5>
        <img src="/uploads/{{ uploaded_image_path }}" class="uploaded-img shadow">
    </div>
    {% endif %}

    <!-- Prediction Card -->
    {% if prediction_text %}
    <div class="card shadow-sm p-4 mt-4">
        <h4 class="text-center text-primary fw-bold">{{ prediction_text }}</h4>

        {% if disease_description %}
        <div class="info-box mt-3">
            <h5 class="fw-bold">About This Condition</h5>
            <p>{{ disease_description }}</p>
        </div>
        {% endif %}

        {% if disease_care %}
        <div class="care-box mt-3">
            <h5 class="fw-bold">Care Recommendations</h5>
            <p>{{ disease_care }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Doctors Section -->
<section class="bg-light py-5">
    <div class="container">
        <h2 class="text-center fw-semibold mb-4">Find Dermatologists Near You</h2>

        <div class="text-center mb-3">
            <input id="searchCity" class="form-control form-control-lg w-50 mx-auto"
                   placeholder="Search by city (e.g., Hyderabad)">
        </div>

        <div class="row g-4" id="doctorList">

            <!-- Doctor #1 (example) -->
            <div class="col-md-4 doctor-card" data-city="Hyderabad Secunderabad">
                <div class="card shadow-sm">
                    <img src="https://img.freepik.com/free-photo/doctor-with-co-workers-analyzing-x-ray_1098-2176.jpg"
                         class="card-img-top">

                    <div class="card-body">
                        <h5 class="fw-bold">Dr. Arjun Mehta</h5>
                        <p class="text-muted">Apollo Hospitals, Hyderabad</p>

                        <!-- Payment First -->
                        <button class="btn btn-primary w-100"
                                onclick="startPayment('Dr. Arjun Mehta')">
                            ðŸ’³ Pay â‚¹99 & Book Appointment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add more doctors if needed -->
             <!-- Doctor #2 -->
<div class="col-md-4 doctor-card" data-city="Bangalore Bengaluru">
    <div class="card shadow-sm">
        <img src="https://img.freepik.com/free-photo/portrait-smiling-female-doctor-hospital_53419-1517.jpg"
             class="card-img-top">

        <div class="card-body">
            <h5 class="fw-bold">Dr. Priya Sharma</h5>
            <p class="text-muted">Fortis Hospital, Bangalore</p>

            <button class="btn btn-primary w-100"
                    onclick="startPayment('Dr. Priya Sharma')">
                ðŸ’³ Pay â‚¹99 & Book Appointment
            </button>
        </div>
    </div>
</div>
<!-- Doctor #3 -->
<div class="col-md-4 doctor-card" data-city="Delhi New Delhi">
    <div class="card shadow-sm">
        <img src="https://img.freepik.com/free-photo/portrait-smiling-young-male-doctor-standing-hospital-corridor_53419-1606.jpg"
             class="card-img-top">

        <div class="card-body">
            <h5 class="fw-bold">Dr. Neeraj Kapoor</h5>
            <p class="text-muted">AIIMS Hospital, New Delhi</p>

            <button class="btn btn-primary w-100"
                    onclick="startPayment('Dr. Neeraj Kapoor')">
                ðŸ’³ Pay â‚¹99 & Book Appointment
            </button>
        </div>
    </div>
</div>


        </div>
    </div>
</section>

<!-- Appointment Modal -->
<div class="modal fade" id="appointmentModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Book Appointment</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <form id="appointmentForm">
                    <input type="hidden" id="paymentId">

                    <div class="mb-3">
                        <label class="form-label">Doctor</label>
                        <input id="appointmentDoctor" class="form-control" readonly>
                    </div>

                    <div class="mb-3">
                        <label>Your Name</label>
                        <input id="patientName" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label>Email</label>
                        <input id="patientEmail" type="email" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label>Phone</label>
                        <input id="patientPhone" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label>Date</label>
                        <input id="appointmentDate" type="date" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label>Time</label>
                        <input id="appointmentTime" type="time" class="form-control" required>
                    </div>
                </form>

                <div id="appointmentSuccess" class="alert alert-success d-none mt-3">
                    Appointment booked successfully! âœ”
                </div>

            </div>

            <div class="modal-footer">
                <button class="btn btn-success w-100"
                        onclick="submitAppointment()">
                    Save Appointment
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
let selectedDoctor = "";

function startPayment(doctorName) {
    selectedDoctor = doctorName;

    fetch("/create_order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount: 99 })
    })
    .then(r => r.json())
    .then(order => {

        let options = {
            "key": "{{ razorpay_key }}",
            "amount": order.amount,
            "currency": "INR",
            "name": "SkinAI Hub",
            "description": "Appointment Fee",
            "order_id": order.id,

            "handler": function (response) {
                document.getElementById("paymentId").value =
                    response.razorpay_payment_id;

                document.getElementById("appointmentDoctor").value = selectedDoctor;

                new bootstrap.Modal(document.getElementById("appointmentModal")).show();
            }
        };

        new Razorpay(options).open();
    });
}

function submitAppointment() {
    let data = {
        doctor: document.getElementById("appointmentDoctor").value,
        name: document.getElementById("patientName").value,
        email: document.getElementById("patientEmail").value,
        phone: document.getElementById("patientPhone").value,
        date: document.getElementById("appointmentDate").value,
        time: document.getElementById("appointmentTime").value,
        payment_id: document.getElementById("paymentId").value
    };

    fetch("/save_appointment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(res => {
        if (res.status === "success") {
            document.getElementById("appointmentSuccess").classList.remove("d-none");

            setTimeout(() => {
                location.reload();
            }, 2000);
        }
    });
}

document.getElementById("searchCity").addEventListener("keyup", function() {
    let input = this.value.toLowerCase();
    document.querySelectorAll(".doctor-card").forEach(card => {
        card.style.display = card.getAttribute("data-city").toLowerCase().includes(input)
            ? "block"
            : "none";
    });
});
</script>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
